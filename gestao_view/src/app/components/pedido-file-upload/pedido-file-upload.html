<div class="upload-container">
  <h3 class="section-title">Anexar Novos Arquivos</h3>

  <!-- Área de Drag and Drop -->
  <div 
    class="drop-zone"
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave($event)"
    (drop)="onDrop($event)"
    [class.drag-over]="isDragging">

    <!-- Input de arquivo oculto -->
    <input type="file" #fileInput (change)="onFileSelected($event)" multiple hidden>

    <!-- Conteúdo da Drop Zone -->
    @if (files.length > 0) {
      <div class="file-list">
        @for (fileState of files; track fileState.file.name) {
          <div class="file-item">
            <div class="file-icon-wrapper">
              <svg class="file-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm64 236c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12v8zm0-64c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12v8zm0-64c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12v8zM384 128L256 0v128h128z"/></svg>
              @if (fileState.status === 'uploading') {
                <div class="progress-bar"><div class="progress" [style.width.%]="fileState.progress"></div></div>
              } @else if (fileState.status === 'success') {
                <div class="status-overlay success">✓</div>
              } @else if (fileState.status === 'error') {
                <div class="status-overlay error">✗</div>
              }
            </div>
            <span class="file-name" [title]="fileState.file.name">{{ fileState.file.name }}</span>
            @if (fileState.status === 'pending') {
              <button class="remove-btn" (click)="removeFile(fileState.file.name)" title="Remover arquivo">×</button>
            }
          </div>
        }
      </div>
    } @else {
      <!-- Mensagem padrão da dropzone -->
      <svg xmlns="http://www.w3.org/2000/svg" width="50" height="43" viewBox="0 0 50 43"><path d="M48.4 26.5c-.9 0-1.7.7-1.7 1.7v11.6h-43.3v-11.6c0-.9-.7-1.7-1.7-1.7s-1.7.7-1.7 1.7v13.2c0 .9.7 1.7 1.7 1.7h46.7c.9 0 1.7-.7 1.7-1.7v-13.2c0-1-.7-1.7-1.7-1.7zm-24.5 6.1c.3.3.8.5 1.2.5.4 0 .9-.2 1.2-.5l10-11.6c.7-.7.7-1.7 0-2.4s-1.7-.7-2.4 0l-7.1 8.3v-25.3c0-.9-.7-1.7-1.7-1.7s-1.7.7-1.7 1.7v25.3l-7.1-8.3c-.7-.7-1.7-.7-2.4 0s-.7 1.7 0 2.4l10 11.6z"></path></svg>
      <p>Arraste e solte arquivos aqui</p>
      <button type="button" (click)="fileInput.click()">Ou selecione os arquivos</button>
    }
  </div>

  <!-- Botões de Ação -->
  <div class="button-container">
    <button class="cancel-btn" (click)="cancelar()" [disabled]="isUploading">
      Cancelar
    </button>
    <button class="upload-btn" (click)="onUpload()" [disabled]="isUploading || files.length === 0">
      {{ isUploading ? 'Enviando...' : 'Salvar arquivos' }}
    </button>
  </div>

@if (arquivos.length > 0) {
  <div class="arquivos-existentes">
    <h4 class="section-title">Arquivos já enviados</h4>
    <ul class="arquivos-lista">
      @for (arquivo of arquivos; track arquivo.id) {
        <li>
          <!-- Link para download direto -->
          <a [href]="arquivo.file" [attr.download]="arquivo.file_name" target="_blank" [title]="arquivo.file_name">
            {{ arquivo.file_name }}
          </a>
          <!-- Botão de download explícito -->
          <button type="button"
                  (click)="baixarArquivo(arquivo)"
                  title="Baixar arquivo"
                  class="btn-download">
            Baixar
          </button>
        </li>
      }
    </ul>
  </div>
}
</div>